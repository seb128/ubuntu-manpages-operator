{{ define "title" }}Search | Ubuntu Manpages{{ end }}

{{ define "head-meta" }}
    <meta name="robots" content="noindex, follow" />
{{ end }}

{{ define "page-title" }}
<div class="l-docs__title" id="main-content"></div>
{{ end }}

{{ define "result-list" }}
<ul class="p-list">
  {{ range .Results }}
  <li class="p-list__item">
    <a href="{{ .Path }}">{{ .Name }}</a>
    <div class="mp-search-meta">man({{ .Section }}){{ if .Desc }} &middot; {{ .Desc }}{{ end }}</div>
  </li>
  {{ end }}
</ul>
{{ end }}

{{ define "main" }}
<div class="row">
  <div class="col-10">
    {{ if .Query }}
      {{ if .SearchError }}
        <p class="u-text--muted mp-search-summary">Search is unavailable.</p>
      {{ else if eq .Total 0 }}
        <p class="u-text--muted mp-search-summary">No results found.</p>
      {{ else }}
        <div class="u-text--muted mp-search-summary">
          {{ .Total }} result{{ if ne .Total 1 }}s{{ end }} found.
        </div>
        {{ if eq (len .ResultGroups) 1 }}
          {{ template "result-list" (index .ResultGroups 0) }}
        {{ else }}
          <div class="p-tabs">
            <div class="p-tabs__list" role="tablist" aria-label="Results by release">
              {{ range $i, $g := .ResultGroups }}
              <div class="p-tabs__item">
                <button class="p-tabs__link" role="tab"
                  id="tab-{{ $g.Distro }}"
                  aria-selected="{{ if eq $i 0 }}true{{ else }}false{{ end }}"
                  aria-controls="panel-{{ $g.Distro }}"
                  {{ if ne $i 0 }}tabindex="-1"{{ end }}>
                  {{ $g.Label }} ({{ $g.Count }})
                </button>
              </div>
              {{ end }}
            </div>
            {{ range $i, $g := .ResultGroups }}
            <div role="tabpanel" id="panel-{{ $g.Distro }}"
              aria-labelledby="tab-{{ $g.Distro }}" tabindex="0"
              {{ if ne $i 0 }}hidden="hidden"{{ end }}>
              {{ template "result-list" $g }}
            </div>
            {{ end }}
          </div>
        {{ end }}
      {{ end }}
    {{ else }}
      <div class="mp-search-empty">
        <p class="p-heading--4">Search across every manpage in Ubuntu</p>
        <p>Try something like:</p>
        <div class="mp-search-suggestions">
          <a class="p-chip" href="/search?q=systemctl"><span class="p-chip__value">systemctl</span></a>
          <a class="p-chip" href="/search?q=grep"><span class="p-chip__value">grep</span></a>
          <a class="p-chip" href="/search?q=nginx"><span class="p-chip__value">nginx</span></a>
          <a class="p-chip" href="/search?q=ssh_config"><span class="p-chip__value">ssh_config</span></a>
          <a class="p-chip" href="/search?q=crontab"><span class="p-chip__value">crontab</span></a>
          <a class="p-chip" href="/search?q=iptables"><span class="p-chip__value">iptables</span></a>
        </div>
      </div>
    {{ end }}
  </div>
</div>
{{ end }}

{{ define "scripts" }}
{{ if .Query }}
<script>
  var input = document.querySelector("#search-docs .p-search-box__input");
  if (input) input.value = {{ .Query }};
</script>
{{ end }}
{{ if and .Query (gt (len .ResultGroups) 1) }}
<script>
  document.querySelectorAll("[role='tab']").forEach(function (tab) {
    tab.addEventListener("click", function () {
      var id = this.id;
      document.querySelectorAll("[role='tab']").forEach(function (t) {
        var active = t.id === id;
        t.setAttribute("aria-selected", active);
        t.tabIndex = active ? 0 : -1;
      });
      document.querySelectorAll("[role='tabpanel']").forEach(function (p) {
        if (p.getAttribute("aria-labelledby") === id) {
          p.removeAttribute("hidden");
        } else {
          p.setAttribute("hidden", "hidden");
        }
      });
    });
  });
</script>
{{ end }}
{{ end }}
